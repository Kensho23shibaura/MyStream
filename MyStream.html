<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vspo</title>
  <link rel="stylesheet" href="style.css?param=3.7">
  <link rel="stylesheet" href="popup.css">
  <script type="text/javascript" src="popup.js"></script>
</head>

<body>
  <div class="iconArea">
  </div>
  <div class="Area">
    <div class="videoArea">
      <div id="ReplaceArea">

        <div class="big story" id="w01">
          <div class="clear">×</div>
          <iframe class="video" src="" title="YouTube video player" frameborder="0"
            allow="accelerometer; autoplay; encrypted-media;" allowfullscreen></iframe>
          <iframe class="chats" src="" frameborder="0"></iframe>
        </div>
        <div class="big story" id="w02">
          <div class="clear">×</div>
          <iframe class="video" src="" title="YouTube video player" frameborder="0"
            allow="accelerometer; autoplay; encrypted-media;" allowfullscreen></iframe>
          <iframe class="chats" src="" frameborder="0"></iframe>
        </div>
        <div class="big story" id="w03">
          <div class="clear">×</div>
          <iframe class="video" src="" title="YouTube video player" frameborder="0"
            allow="accelerometer; autoplay; encrypted-media;" allowfullscreen></iframe>
          <iframe class="chats" src="" frameborder="0"></iframe>
        </div>
        <div class="big story" id="w04">
          <div class="clear">×</div>
          <iframe class="video" src="" title="YouTube video player" frameborder="0"
            allow="accelerometer; autoplay; encrypted-media;" allowfullscreen></iframe>
          <iframe class="chats" src="" frameborder="0"></iframe>
        </div>
        <div class="big story" id="w05">
          <div class="clear">×</div>
          <iframe class="video" src="" title="YouTube video player" frameborder="0"
            allow="accelerometer; autoplay; encrypted-media;" allowfullscreen></iframe>
          <iframe class="chats" src="" frameborder="0"></iframe>
        </div>
        <div class="big story" id="w06">
          <div class="clear">×</div>
          <iframe class="video" src="" title="YouTube video player" frameborder="0"
            allow="accelerometer; autoplay; encrypted-media;" allowfullscreen></iframe>
          <iframe class="chats" src="" frameborder="0"></iframe>
        </div>
        <div class="big story" id="w07">
          <div class="clear">×</div>
          <iframe class="video" src="" title="YouTube video player" frameborder="0"
            allow="accelerometer; autoplay; encrypted-media;" allowfullscreen></iframe>
          <iframe class="chats" src="" frameborder="0"></iframe>
        </div>
        <div class="big story" id="w08">
          <div class="clear">×</div>
          <iframe class="video" src="" title="YouTube video player" frameborder="0"
            allow="accelerometer; autoplay; encrypted-media;" allowfullscreen></iframe>
          <iframe class="chats" src="" frameborder="0"></iframe>
        </div>
        <div class="big story" id="w09">
          <div class="clear">×</div>
          <iframe class="video" src="" title="YouTube video player" frameborder="0"
            allow="accelerometer; autoplay; encrypted-media;" allowfullscreen></iframe>
        </div>
        <div class="big story" id="w10">
          <div class="clear">×</div>
          <iframe class="video" src="" title="YouTube video player" frameborder="0"
            allow="accelerometer; autoplay; encrypted-media;" allowfullscreen></iframe>
        </div>
        <div class="big story" id="w11">
          <div class="clear">×</div>
          <iframe class="video" src="" title="YouTube video player" frameborder="0"
            allow="accelerometer; autoplay; encrypted-media;" allowfullscreen></iframe>
        </div>
        <div class="big story" id="w12">
          <div class="clear">×</div>
          <iframe class="video" src="" title="YouTube video player" frameborder="0"
            allow="accelerometer; autoplay; encrypted-media;" allowfullscreen></iframe>
        </div>
        <div class="big story" id="w13">
          <div class="clear">×</div>
          <iframe class="video" src="" title="YouTube video player" frameborder="0"
            allow="accelerometer; autoplay; encrypted-media;" allowfullscreen></iframe>
        </div>
        <div class="big story" id="w14">
          <div class="clear">×</div>
          <iframe class="video" src="" title="YouTube video player" frameborder="0"
            allow="accelerometer; autoplay; encrypted-media;" allowfullscreen></iframe>
        </div>
        <div class="big story" id="w15">
          <div class="clear">×</div>
          <iframe class="video" src="" title="YouTube video player" frameborder="0"
            allow="accelerometer; autoplay; encrypted-media;" allowfullscreen></iframe>
        </div>
        <div class="big story" id="w16">
          <div class="clear">×</div>
          <iframe class="video" src="" title="YouTube video player" frameborder="0"
            allow="accelerometer; autoplay; encrypted-media;" allowfullscreen></iframe>
        </div>

      </div>
    </div>
    <div class="selectArea"><br>
      <img src="select/01A.png" class="select" id="select01A" title="01A" onclick="selectL('01A')">
      <img src="select/01B.png" class="select" id="select01B" title="01B" onclick="selectL('01B')"><br>
      <img src="select/02A.png" class="select" id="select02A" title="02A" onclick="selectL('02A')"><br>
      <img src="select/03A.png" class="select" id="select03A" title="03A" onclick="selectL('03A')">
      <img src="select/03B.png" class="select" id="select03B" title="03B" onclick="selectL('03B')"><br>
      <img src="select/04A.png" class="select" id="select04A" title="04A" onclick="selectL('04A')">
      <img src="select/04B.png" class="select" id="select04B" title="04B" onclick="selectL('04B')">
      <img src="select/04C.png" class="select" id="select04C" title="04C" onclick="selectL('04C')"><br>
      <img src="select/05A.png" class="select" id="select05A" title="05A" onclick="selectL('05A')">
      <img src="select/05B.png" class="select" id="select05B" title="05B" onclick="selectL('05B')">
      <img src="select/05C.png" class="select" id="select05C" title="05C" onclick="selectL('05C')"><br>
      <img src="select/06A.png" class="select" id="select06A" title="06A" onclick="selectL('06A')">
      <img src="select/06B.png" class="select" id="select06B" title="06B" onclick="selectL('06B')">
      <img src="select/06C.png" class="select" id="select06C" title="06C" onclick="selectL('06C')"><br>
      <img src="select/07A.png" class="select" id="select07A" title="07A" onclick="selectL('07A')"><br>
      <img src="select/08A.png" class="select" id="select08A" title="08A" onclick="selectL('08A')">
      <img src="select/08B.png" class="select" id="select08B" title="08B" onclick="selectL('08B')"><br>
      <img src="select/09A.png" class="select" id="select09A" title="09A" onclick="selectL('09A')">
      <img src="select/09B.png" class="select" id="select09B" title="09B" onclick="selectL('09B')"><br>
      <img src="select/10A.png" class="select" id="select10A" title="10A" onclick="selectL('10A')"><br>
      <img src="select/12A.png" class="select" id="select12A" title="12A" onclick="selectL('12A')"><br>
      <img src="select/16A.png" class="select" id="select16A" title="16A" onclick="selectL('16A')"><br>
      <button type="button" class="Check ButtonL" onclick="CheckStream()">配信チェック</button><br>
      <button type="button" class="Slide ButtonL" onclick="SlideWindow()">空窓スライド</button><br>
      <button type="button" class="Reset ButtonL" onclick="ResetWindow()">全窓リセット</button><br>
      <button type="button" class="NewFC ButtonL" onclick="NewFunction()">新規機能確認</button><br>
    </div>
  </div>

  <script>

    let channelData = null;

    function createIconElements() {
      fetch('channels.json')
        .then(response => response.json())
        .then(jsonData => {
          channelData = jsonData; // ローカル変数にデータを格納
          console.log(channelData)
          const iconArea = document.querySelector('.iconArea');
          channelData.channels.forEach(channel => {
            if (channel.No >= 1 && channel.No <= 38) {
              const div = document.createElement('div');
              div.className = 'icondiv';
              div.setAttribute('alt', channel.Name);

              const img = document.createElement('img');
              img.src = channel.Icon;
              img.className = 'icon';
              img.id = `icon${channel.No}`;
              img.setAttribute('onclick', `openLink('${channel.No}')`);

              div.appendChild(img);
              iconArea.appendChild(div);
            }
          });
        })
        .catch(error => console.error('Error fetching JSON:', error));
    }

    function CheckStream() {
      const alli = ["00", "01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19",
        "31", "32", "33", "34", "35", "36", "37", "38"];
      alli.forEach(async (key, index) => {
        console.log("CheckStream", key)
        let result = await getLink(key);
        let type = result[0];
        let text = result[1];
        let timeflag = result[2];
        var parm = window.location.search;
        //パラメータ探索
        let exsist = 0;
        if (parm.indexOf("icon" + key) != -1) {
          exsist = 1;
        }
        if ((text != '') && (type == "Y") && (timeflag == 0)) {
          if (exsist == 1) {
            document.getElementById("icon" + key).style.border = "solid 3px rgba(177,29,44,1)";//赤
          } else {
            document.getElementById("icon" + key).style.border = "solid 3px rgba(60,179,113,1)";//緑
          }
        } else {
          if (exsist == 1) {
            document.getElementById("icon" + key).style.border = "solid 3px rgba(139,0,0,1)";//薄赤
          } else {
            document.getElementById("icon" + key).style.border = "solid 3px rgba(0,0,0,0.5)";//灰色
          }
        }
      });
    }
    function SlideWindow() {
      var url = new URL(window.location);

      const allw = ["w01", "w02", "w03", "w04", "w05", "w06", "w07", "w08", "w09", "w10", "w11", "w12", "w13", "w14", "w15", "w16"];
      var arr = [];
      allw.forEach((wNo, index) => {
        document.getElementById(wNo).classList.add("cleared");

        var current = new URL(window.location);
        let text = current.searchParams.get(wNo);
        if (text != null) {
          arr.push([wNo, text]);
        }
        current.searchParams.delete(document.getElementById(wNo).id);
        window.history.replaceState('', '', current);

      });
      allw.forEach((wNo, index) => {
        if (arr.length > index) {
          var current = new URL(window.location);
          current.searchParams.append(wNo, arr[index][1]);
          window.history.replaceState('', '', current);
        }
      });

      url = new URL(window.location);
      console.log(url);
      startWindow();
      restartWindow();

    }
    function ResetWindow() {

      //再生を停止・パラメータを削除
      const allw = ["w01", "w02", "w03", "w04", "w05", "w06", "w07", "w08", "w09", "w10", "w11", "w12", "w13", "w14", "w15", "w16"];
      allw.forEach((wNo, index) => {
        document.getElementById(wNo).getElementsByClassName("video")[0].src = "";
        document.getElementById(wNo).getElementsByClassName("video")[0].classList.add("no-content");
        try {
          document.getElementById(wNo).getElementsByClassName("chats")[0].src = "";
          document.getElementById(wNo).getElementsByClassName("chats")[0].classList.add("no-content");
        } catch (e) { }
        document.getElementById(wNo).classList.add("cleared");

        var current = new URL(window.location);
        current.searchParams.delete(document.getElementById(wNo).id);
        window.history.replaceState('', '', current);
      });
      selectL('16A');
      CheckStream();

    }
    function NewFunction() {
      showAlert('更新情報', '特になし', 'noClose');
    }
    function selectL(Lay) {

      var current = new URL(window.location);
      current.searchParams.set("layout", Lay);
      window.history.replaceState('', '', current);

      //全ての窓の余計なクラスを削除
      const all = ["w01", "w02", "w03", "w04", "w05", "w06", "w07", "w08", "w09", "w10", "w11", "w12", "w13", "w14", "w15", "w16"];
      all.forEach((wNo, index) => {
        if (document.getElementById(wNo).classList.contains('Non-Display') == true) {
          document.getElementById(wNo).className = "story cleared";
        } else if (document.getElementById(wNo).classList.contains('cleared') == true) {
          document.getElementById(wNo).className = "story cleared";
        } else {
          document.getElementById(wNo).className = "story";
        }
        document.getElementById("ReplaceArea").className = "grid6R7C";
      });

      let arr = [];
      let now = [];

      switch (Lay) {
        case "01A"://6R7C_ok
          document.getElementById("w01").classList.add("WE01", "VSE");
          arr = ["w02", "w03", "w04", "w05", "w06", "w07", "w08", "w09", "w10", "w11", "w12", "w13", "w14", "w15", "w16"];
          break;
        case "01B"://6R7C_ok
          document.getElementById("w01").classList.add("WD01C", "VSD", "CSD");
          arr = ["w02", "w03", "w04", "w05", "w06", "w07", "w08", "w09", "w10", "w11", "w12", "w13", "w14", "w15", "w16"];
          break;
        case "02A"://6R7C_ok

          document.getElementById("w01").classList.add("WC01C", "VSC", "CSC");
          document.getElementById("w02").classList.add("WC03C", "VSC", "CSC");
          arr = ["w03", "w04", "w05", "w06", "w07", "w08", "w09", "w10", "w11", "w12", "w13", "w14", "w15", "w16"];
          break;
        case "03A"://6R7C_ok

          document.getElementById("w01").classList.add("WB01C", "VSB", "CSB");
          document.getElementById("w02").classList.add("WB04C", "VSB", "CSB");
          document.getElementById("w03").classList.add("WB07C", "VSB", "CSB");
          arr = ["w04", "w05", "w06", "w07", "w08", "w09", "w10", "w11", "w12", "w13", "w14", "w15", "w16"];
          break;
        case "03B"://6R7C_ok

          document.getElementById("w01").classList.add("WC01C", "VSC", "CSC");
          document.getElementById("w02").classList.add("WC03", "VSC");
          document.getElementById("w03").classList.add("WC04", "VSC");
          arr = ["w04", "w05", "w06", "w07", "w08", "w09", "w10", "w11", "w12", "w13", "w14", "w15", "w16"];
          break;
        case "04A"://6R7C_ok

          document.getElementById("w01").classList.add("WA01C3", "VSA", "CSD");
          document.getElementById("w02").classList.add("WA05C3", "VSA", "CSD");
          document.getElementById("w03").classList.add("WA09C3", "VSA", "CSD");
          document.getElementById("w04").classList.add("WA13C3", "VSA", "CSD");
          arr = ["w05", "w06", "w07", "w08", "w09", "w10", "w11", "w12", "w13", "w14", "w15", "w16"];
          break;
        case "04B"://6R7C_ok

          document.getElementById("w01").classList.add("WC01C", "VSC", "CSC");
          document.getElementById("w02").classList.add("WB07H", "VSB");
          document.getElementById("w03").classList.add("WB08H", "VSB");
          document.getElementById("w04").classList.add("WB09H", "VSB");
          arr = ["w05", "w06", "w07", "w08", "w09", "w10", "w11", "w12", "w13", "w14", "w15", "w16"];
          break;
        case "04C"://6R7C_ok

          document.getElementById("w01").classList.add("WC01", "VSC");
          document.getElementById("w02").classList.add("WC02", "VSC");
          document.getElementById("w03").classList.add("WC03", "VSC");
          document.getElementById("w04").classList.add("WC04", "VSC");
          arr = ["w05", "w06", "w07", "w08", "w09", "w10", "w11", "w12", "w13", "w14", "w15", "w16"];
          break;
        case "05A"://6R7C_ok

          document.getElementById("w01").classList.add("WC01C", "VSC", "CSC");
          document.getElementById("w02").classList.add("WA10", "VSA");
          document.getElementById("w03").classList.add("WA11", "VSA");
          document.getElementById("w04").classList.add("WA14", "VSA");
          document.getElementById("w05").classList.add("WA15", "VSA");
          arr = ["w06", "w07", "w08", "w09", "w10", "w11", "w12", "w13", "w14", "w15", "w16"];
          break;
        case "05B"://6R7C_ok

          document.getElementById("w01").classList.add("WB01C", "VSB", "CSB");
          document.getElementById("w02").classList.add("WB04C", "VSB", "CSB");
          document.getElementById("w03").classList.add("WB07", "VSB");
          document.getElementById("w04").classList.add("WB08", "VSB");
          document.getElementById("w05").classList.add("WB09", "VSB");
          arr = ["w06", "w07", "w08", "w09", "w10", "w11", "w12", "w13", "w14", "w15", "w16"];
          break;
        case "05C"://6R7C_ok

          document.getElementById("w01").classList.add("WC01", "VSC");
          document.getElementById("w02").classList.add("WC02", "VSC");
          document.getElementById("w03").classList.add("WB07H", "VSB");
          document.getElementById("w04").classList.add("WB08H", "VSB");
          document.getElementById("w05").classList.add("WB09H", "VSB");
          arr = ["w06", "w07", "w08", "w09", "w10", "w11", "w12", "w13", "w14", "w15", "w16"];
          break;
        case "06A"://6R7C_ok

          document.getElementById("w01").classList.add("WC01", "VSC");
          document.getElementById("w02").classList.add("WC02", "VSC");
          document.getElementById("w03").classList.add("WA10", "VSA");
          document.getElementById("w04").classList.add("WA11", "VSA");
          document.getElementById("w05").classList.add("WA14", "VSA");
          document.getElementById("w06").classList.add("WA15", "VSA");
          arr = ["w07", "w08", "w09", "w10", "w11", "w12", "w13", "w14", "w15", "w16"];
          break;
        case "06B"://6R7C_ok?

          document.getElementById("w01").classList.add("WB01C", "VSB", "CSB");
          document.getElementById("w02").classList.add("WB04C", "VSB", "CSB");
          document.getElementById("w03").classList.add("WA13", "VSA");
          document.getElementById("w04").classList.add("WA14", "VSA");
          document.getElementById("w05").classList.add("WA15", "VSA");
          document.getElementById("w06").classList.add("WA16", "VSA");
          arr = ["w07", "w08", "w09", "w10", "w11", "w12", "w13", "w14", "w15", "w16"];
          break;
        case "06C"://6R7C_ok

          document.getElementById("w01").classList.add("WB01", "VSB");
          document.getElementById("w02").classList.add("WB02", "VSB");
          document.getElementById("w03").classList.add("WB04", "VSB");
          document.getElementById("w04").classList.add("WB05", "VSB");
          document.getElementById("w05").classList.add("WB07", "VSB");
          document.getElementById("w06").classList.add("WB08", "VSB");
          arr = ["w07", "w08", "w09", "w10", "w11", "w12", "w13", "w14", "w15", "w16"];
          break;
        case "07A"://6R7C_ok

          document.getElementById("w01").classList.add("WC01C", "VSC", "CSC");
          document.getElementById("w02").classList.add("WA09", "VSA");
          document.getElementById("w03").classList.add("WA10", "VSA");
          document.getElementById("w04").classList.add("WA11", "VSA");
          document.getElementById("w05").classList.add("WA13", "VSA");
          document.getElementById("w06").classList.add("WA14", "VSA");
          document.getElementById("w07").classList.add("WA15", "VSA");
          arr = ["w08", "w09", "w10", "w11", "w12", "w13", "w14", "w15", "w16"];
          break;
        case "08A"://6R7C_ok

          document.getElementById("w01").classList.add("WC01", "VSC");
          document.getElementById("w02").classList.add("WC02", "VSC");
          document.getElementById("w03").classList.add("WA09", "VSA");
          document.getElementById("w04").classList.add("WA10", "VSA");
          document.getElementById("w05").classList.add("WA11", "VSA");
          document.getElementById("w06").classList.add("WA13", "VSA");
          document.getElementById("w07").classList.add("WA14", "VSA");
          document.getElementById("w08").classList.add("WA15", "VSA");
          arr = ["w09", "w10", "w11", "w12", "w13", "w14", "w15", "w16"];
          break;
        case "08B"://6R7C_ok
          document.getElementById("w01").classList.add("WA01C1", "VSA", "CSA");
          document.getElementById("w02").classList.add("WA03C1", "VSA", "CSA");
          document.getElementById("w03").classList.add("WA05C1", "VSA", "CSA");
          document.getElementById("w04").classList.add("WA07C1", "VSA", "CSA");
          document.getElementById("w05").classList.add("WA09C1", "VSA", "CSA");
          document.getElementById("w06").classList.add("WA11C1", "VSA", "CSA");
          document.getElementById("w07").classList.add("WA13C1", "VSA", "CSA");
          document.getElementById("w08").classList.add("WA15C1", "VSA", "CSA");
          arr = ["w09", "w10", "w11", "w12", "w13", "w14", "w15", "w16"];
          break;
        case "09A"://6R7C_ok

          document.getElementById("w01").classList.add("WC01C", "VSC", "CSC");
          document.getElementById("w02").classList.add("WA09", "VSA");
          document.getElementById("w03").classList.add("WA10", "VSA");
          document.getElementById("w04").classList.add("WA11", "VSA");
          document.getElementById("w05").classList.add("WA12", "VSA");
          document.getElementById("w06").classList.add("WA13", "VSA");
          document.getElementById("w07").classList.add("WA14", "VSA");
          document.getElementById("w08").classList.add("WA15", "VSA");
          document.getElementById("w09").classList.add("WA16", "VSA");
          arr = ["w10", "w11", "w12", "w13", "w14", "w15", "w16"];
          break;
        case "09B"://6R7C_ok
          now = ["01", "02", "03", "04", "05", "06", "07", "08", "09"];
          now.forEach((wNo, index) => {
            document.getElementById("w" + wNo).classList.add("WB" + wNo, "VSB");
          });
          arr = ["w10", "w11", "w12", "w13", "w14", "w15", "w16"];
          break;
        case "10A"://6R7C_ok

          document.getElementById("w01").classList.add("WC01", "VSC");
          document.getElementById("w02").classList.add("WC02", "VSC");
          document.getElementById("w03").classList.add("WA09", "VSA");
          document.getElementById("w04").classList.add("WA10", "VSA");
          document.getElementById("w05").classList.add("WA11", "VSA");
          document.getElementById("w06").classList.add("WA12", "VSA");
          document.getElementById("w07").classList.add("WA13", "VSA");
          document.getElementById("w08").classList.add("WA14", "VSA");
          document.getElementById("w09").classList.add("WA15", "VSA");
          document.getElementById("w10").classList.add("WA16", "VSA");
          arr = ["w11", "w12", "w13", "w14", "w15", "w16"];
          break;
        case "12A"://6R7C_ok

          document.getElementById("w01").classList.add("WA01", "VSA");
          document.getElementById("w02").classList.add("WA02", "VSA");
          document.getElementById("w03").classList.add("WA03", "VSA");
          document.getElementById("w04").classList.add("WA05", "VSA");
          document.getElementById("w05").classList.add("WA06", "VSA");
          document.getElementById("w06").classList.add("WA07", "VSA");
          document.getElementById("w07").classList.add("WA09", "VSA");
          document.getElementById("w08").classList.add("WA10", "VSA");
          document.getElementById("w09").classList.add("WA11", "VSA");
          document.getElementById("w10").classList.add("WA13", "VSA");
          document.getElementById("w11").classList.add("WA14", "VSA");
          document.getElementById("w12").classList.add("WA15", "VSA");
          arr = ["w13", "w14", "w15", "w16"];
          break;
        case "16A"://6R7C_ok
          now = ["01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12", "13", "14", "15", "16"];
          now.forEach((wNo, index) => {
            document.getElementById("w" + wNo).classList.add("WA" + wNo, "VSA");
          });
          arr = [];
          break;
        default:
          now = [];
          arr = [];
      }

      arr.forEach((wNo, index) => {
        //再生を停止
        document.getElementById(wNo).classList.remove("cleared");
        document.getElementById(wNo).classList.add("Non-Display");
        document.getElementById(wNo).getElementsByClassName("video")[0].src = "";
        document.getElementById(wNo).getElementsByClassName("video")[0].classList.add("no-content");
        try {
          document.getElementById(wNo).getElementsByClassName("chats")[0].src = "";
          document.getElementById(wNo).getElementsByClassName("chats")[0].classList.add("no-content");
        } catch (e) { }

        //再生停止したアイコンの枠を変更・ボタンを有効化・パラメータを削除
        var current = new URL(window.location);
        let iNo = current.searchParams.get(wNo);
        if (iNo != null) {
          if (iNo.indexOf('icon') != -1) {
            document.getElementById(iNo).style.border = "solid 3px rgba(0,0,0,0.5)";
            //document.getElementById(iNo).style.opacity = 1.0;
          }
        }
        current.searchParams.delete(wNo);
        window.history.replaceState('', '', current);

      });

    }
    async function getLink(No) {
      var YID = '';
      var TID = '';
      var StreamType = '';
      var StreamURL = '';
      var StreamTimeFlag = 0;
      const channel = channelData.channels.find(channel => parseInt(channel.No) === parseInt(No));
      if (channel) {
        YID = channel.YID;
        TID = channel.TID;
        StreamType = channel.StreamType;
        StreamURL = channel.StreamURL;
        StreamTimeFlag = channel.StreamTimeFlag;
        console.log([No, StreamType, StreamURL, StreamTimeFlag]);
      } else {
        console.log("No Not Found");
        return [StreamType, StreamURL, StreamTimeFlag];
      }

      if (StreamURL == '') {
        if (YID != '') { // Youtube探索
          console.log("searchID", YID);
          await fetch("https://script.google.com/macros/s/AKfycbyKwScR7pud64Ga8TpTKQzZtAuN3w_0qCODfXv10xQrJOVwrQmnRdkfYlWHPK1G5bjl/exec?name=" + YID)
            .then(response => {
              return response.json();
            })
            .then(data => {
              StreamType = 'Y';
              StreamURL = data.name.id;
              StreamTimeFlag = data.name.timeflag;
              console.log("searchResult", StreamType, YID, StreamURL, StreamTimeFlag);
            })
            .catch(error => {
              console.log("失敗しました");
            });
        }
        if ((StreamURL == '') && (TID != '')) { // Twitch探索
          StreamType = 'T';
          StreamURL = TID;
          console.log("searchTwitch", StreamURL);
        }
      }
      return [StreamType, StreamURL, StreamTimeFlag];
    }
    async function openLink(key) {

      let result = await getLink(key.replace("icon", ""));
      let type = result[0];
      let text = result[1];
      console.log("openlink", key, type, text);
      if (text == '') {
        showAlert('視聴失敗', '生配信が見つかりませんでした');
        return;
      }
      //showAlert('メンテナンス中','生配信リンクの自動取得機能が使えません');

      var url = new URL(window.location);

      //この時点でurlにiNoが存在するなら、cleared[0]じゃなくて該当する窓を指定する（違う場合の指定もここで統一？）
      //URLの更新はかけない方が安全では？（下の処理）

      //枠追加
      if (type == "Y") {//Youtube

        document.getElementsByClassName("cleared")[0].getElementsByClassName("video")[0].classList.remove("no-content");
        document.getElementsByClassName("cleared")[0].getElementsByClassName("video")[0].src = "https://www.youtube.com/embed/" + text + "?autoplay=1";
        try {
          document.getElementsByClassName("cleared")[0].getElementsByClassName("chats")[0].classList.remove("no-content");
          document.getElementsByClassName("cleared")[0].getElementsByClassName("chats")[0].src = "https://www.youtube.com/live_chat?v=" + text + "&embed_domain=" + window.location.hostname;
        } catch (e) { }
        var wNo = document.getElementsByClassName("cleared")[0].id;
        document.getElementsByClassName("cleared")[0].classList.remove("cleared");

      } else if (type == "T") {//Twitch

        document.getElementsByClassName("cleared")[0].getElementsByClassName("video")[0].classList.remove("no-content");
        document.getElementsByClassName("cleared")[0].getElementsByClassName("video")[0].src = "https://player.twitch.tv/?channel=" + text + "&parent=" + url.hostname;
        try {
          document.getElementsByClassName("cleared")[0].getElementsByClassName("chats")[0].classList.remove("no-content");
          document.getElementsByClassName("cleared")[0].getElementsByClassName("chats")[0].src = "https://www.twitch.tv/embed/" + text + "/chat?parent=" + window.location.hostname;
        } catch (e) { }
        var wNo = document.getElementsByClassName("cleared")[0].id;
        document.getElementsByClassName("cleared")[0].classList.remove("cleared");
      }

      var current = new URL(window.location);
      current.searchParams.append(wNo, key);
      window.history.replaceState('', '', current);

      //アイコンの枠変更
      document.getElementById(key).style.border = "solid 3px rgba(177,29,44,1)";
      //document.getElementById(key).disabled = true;

      //ボタン停止・パラメータ保持

    }

    function onDragOver(event) {
      //event.stopPropagation();
      event.preventDefault();
      event.dataTransfer.dropEffect = 'link';
      console.log(event);
    }
    function onDrop(event) {
      event.preventDefault();
      var url = event.dataTransfer.getData("text");

      console.log(event);
      console.log(event.target);
      var text = event.dataTransfer.getData("text").match(/v=[^\&]*/)[0].substr(2);
      var current = new URL(window.location);
      //console.log(typeof(event.target.id));
      current.searchParams.append(event.target.id, text);
      window.history.replaceState('', '', current);
      event.target.classList.remove("cleared");
      event.target.getElementsByClassName("video")[0].classList.remove("no-content");
      event.target.getElementsByClassName("video")[0].src = "https://www.youtube.com/embed/" + text + "?autoplay=1";
      event.target.getElementsByClassName("chats")[0].classList.remove("no-content");
      event.target.getElementsByClassName("chats")[0].src = "https://www.youtube.com/live_chat?v=" + text + "&embed_domain=" + window.location.hostname;

    }
    function onClickClose(event) {
      //console.log(event);
      var current = new URL(window.location);
      //アイコンの状態を戻す
      current.searchParams.forEach((text, key) => {
        console.log(text, key);
        if ((key == event.target.parentNode.id) && (text.indexOf('icon') != -1)) {
          document.getElementById(text).style.border = "solid 3px rgba(0,0,0,0.5)";
          //document.getElementById(text).style.opacity = 1.0;
        }
      });
      current.searchParams.delete(event.target.parentNode.id);
      window.history.replaceState('', '', current);
      event.target.parentNode.classList.add("cleared");
      event.target.parentNode.getElementsByClassName("video")[0].src = "";
      event.target.parentNode.getElementsByClassName("video")[0].classList.add("no-content");
      try {
        event.target.parentNode.getElementsByClassName("chats")[0].src = "";
        event.target.parentNode.getElementsByClassName("chats")[0].classList.add("no-content");
      } catch (e) { }
    }

    function startWindow() {
      //初期化
      var url = new URL(window.location);
      for (var element of document.getElementsByClassName("story")) {
        element.addEventListener("dragover", onDragOver, true);
        element.addEventListener("drop", onDrop, true);
        element.querySelector(".clear").addEventListener("click", onClickClose);
        element.classList.add("cleared");
        element.getElementsByClassName("video")[0].src = "";
        element.getElementsByClassName("video")[0].classList.add("no-content");
        try {
          element.getElementsByClassName("chats")[0].src = "";
          element.getElementsByClassName("chats")[0].classList.add("no-content");
        } catch (e) { }
      }
    }
    function restartWindow() {
      //パラメータ修復
      var url = new URL(window.location);
      selectL('16A');
      let type = 'Y';
      url.searchParams.forEach(async (text, key) => {
        if (key.indexOf('layout') != -1) {
          selectL(text);
          return;
        } else if (text.indexOf('icon') != -1) {
          let key = text;
          console.log("restartWindow", key)
          let result = await getLink(key);
          type = result[0];
          text = result[1];
          document.getElementById(key).style.border = "solid 3px rgba(177,29,44,1)";
          //document.getElementById(key).style.opacity = 0.8;
        }

        var target = document.getElementById(key);
        //枠追加
        if (type == "Y") {//Youtube
          target.getElementsByClassName("video")[0].classList.remove("no-content");
          target.getElementsByClassName("video")[0].src = "https://www.youtube.com/embed/" + text + "?autoplay=1";
          try {
            target.getElementsByClassName("chats")[0].classList.remove("no-content");
            target.getElementsByClassName("chats")[0].src = "https://www.youtube.com/live_chat?v=" + text + "&embed_domain=" + window.location.hostname;
          } catch (e) { }
          var wNo = target.id;
          target.classList.remove("cleared");
        } else if (type == "T") {//Twitch
          target.getElementsByClassName("video")[0].classList.remove("no-content");
          target.getElementsByClassName("video")[0].src = "https://player.twitch.tv/?channel=" + text + "&parent=" + url.hostname;
          var wNo = target.id;
          target.classList.remove("cleared");
        }
      });
    }

    createIconElements();
    startWindow();
    restartWindow();
    // CheckStream();
    //showAlert('メンテナンス中','生配信リンクの自動取得機能が使えません');

  </script>
</body>

</html>